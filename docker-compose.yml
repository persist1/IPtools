version: '3.8'

services:
  iptools:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        QT_VERSION: 5.15.2
        UBUNTU_VERSION: 20.04
    image: iptools:latest
    container_name: iptools
    network_mode: host
    privileged: true  # Required for process/file operations
    environment:
      - DISPLAY=${DISPLAY}
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Mount host proc filesystem (for Linux functionality)
      - /proc:/host_proc:ro
    devices:
      - /dev/dri:/dev/dri  # GPU access (if needed)
    stdin_open: true
    tty: true

  # Multi-architecture build service
  iptools-build-amd64:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    image: iptools:amd64
    platform: linux/amd64

  iptools-build-arm64:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/arm64
    image: iptools:arm64
    platform: linux/arm64

  iptools-build-armv7:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/arm/v7
    image: iptools:armv7
    platform: linux/arm/v7

